@use '../utils/bem';
@use '../utils/map';

@mixin build-classes($blocks) {
  @include -build-blocks($blocks);
}

@mixin -build-blocks($blocks) {
  @each $block, $block-values in $blocks {
    $bem-block: bem.build-bem-block($block);
    $styles: map.get-map-element($block-values, 'styles', (), false);
    $elements: map.get-map-element($block-values, 'elements', (), false);
    $modifiers: map.get-map-element($block-values, 'modifiers', (), false);

    #{$bem-block} {
      @include -build-styles($styles);
      @include -build-elements($elements);
      @include -build-modifiers($modifiers);
    }
  }
}

@mixin -build-elements($elements) {
  @each $element, $element-values in $elements {
    $bem-element: bem.build-bem-element($element);
    $styles: map.get-map-element($element-values, 'styles', (), false);
    $modifiers: map.get-map-element($element-values, 'modifiers', (), false);

    &#{$bem-element} {
      @include -build-styles($styles);
      @include -build-modifiers($modifiers);
    }
  }
}

@mixin -build-modifiers($modifiers) {
  @each $modifier, $styles in $modifiers {
    $bem-modifier: bem.build-bem-modifier($modifier);

    &#{$bem-modifier} {
      @include -build-styles($styles);
    }
  }
}

@mixin -build-styles($styles) {
  @each $property, $value in $styles {
    #{$property}: $value;
  }
}
